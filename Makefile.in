prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
sbindir = @sbindir@
libexecdir = @libexecdir@
datadir = @datadir@
sysconfdir = @sysconfdir@
sharedstatedir = @sharedstatedir@
localstatedir = @localstatedir@
libdir = @libdir@
infodir = @infodir@
mandir = @mandir@
includedir = @includedir@
config_dir = @sysconfdir@/arpalert
leases_dir = @localstatedir@/lib/arpalert
lock_dir = @localstatedir@/run
log_dir = @localstatedir@/log
src_dir = .

CC = @CC@
CFLAGS = -Wall -O2 -DCONFIG_FILE=\"$(config_dir)/arpalert.conf\" -DPID_FILE=\"$(lock_dir)/arpalert.pid\"
LIBS = @LIBS@
OBJECT_LIST = \
	$(src_dir)/arpalert.o \
	$(src_dir)/loadconfig.o \
	$(src_dir)/log.o \
	$(src_dir)/data.o \
	$(src_dir)/maclist.o \
	$(src_dir)/serveur.o \
	$(src_dir)/alerte.o \
	$(src_dir)/sens.o \
	$(src_dir)/sens_timeouts.o \
	$(src_dir)/capture.o

arpalert: $(OBJECT_LIST)
	$(CC) $(CFLAGS) -g -O2 -o arpalert $(OBJECT_LIST) $(LIBS)

log.o: log.c log.h config.h loadconfig.h
	$(CC) $(CFLAGS) -c -o log.o $(src_dir)/log.c $(DEFS)

loadconfig.o: loadconfig.c loadconfig.h config.h log.h
	$(CC) $(CFLAGS) -c -o loadconfig.o $(src_dir)/loadconfig.c

arpalert.o: arpalert.c config.h loadconfig.h log.h data.h maclist.h capture.h \
            serveur.h alerte.h sens.h sens_timeouts.h
	$(CC) $(CFLAGS) -c -o arpalert.o $(src_dir)/arpalert.c

data.o: data.c data.h config.h log.h loadconfig.h
	$(CC) $(CFLAGS) -c -o data.o $(src_dir)/data.c

maclist.o: maclist.c maclist.h config.h data.h loadconfig.h log.h
	$(CC) $(CFLAGS) -c -o maclist.o $(src_dir)/maclist.c

serveur.o: serveur.c serveur.h config.h log.h loadconfig.h
	$(CC) $(CFLAGS) -c -o serveur.o $(src_dir)/serveur.c

capture.o: capture.c capture.h config.h sens.h log.h loadconfig.h data.h alerte.h sens_timeouts.h
	$(CC) $(CFLAGS) -c -o capture.o $(src_dir)/capture.c

sens.o: sens.c sens.h config.h loadconfig.h data.h log.h
	$(CC) $(CFLAGS) -c -o sens.o $(src_dir)/sens.c

sens_timeouts.o: sens_timeouts.c sens_timeouts.h config.h data.h log.h loadconfig.h
	$(CC) $(CFLAGS) -c -o sens_timeouts.o $(src_dir)/sens_timeouts.c

alerte.o: alerte.c alerte.h config.h log.h loadconfig.h errmsg.h
	$(CC) $(CFLAGS) -c -o alerte.o $(src_dir)/alerte.c

clean:
	rm -f *~ *.o
	rm -f arpalert
	rm -f config.log
	rm -f config.status

install:
	mkdir -p $(sbindir)
	mkdir -p $(leases_dir)
	mkdir -p $(lock_dir)
	mkdir -p $(log_dir)
	mkdir -p $(config_dir)	
	mkdir -p $(mandir)/man8
	cp -f doc/arpalert.8 $(mandir)/man8
	cp -f arpalert $(sbindir)
	test ! -f $(config_dir)/maclist.allow && > $(config_dir)/maclist.allow || /bin/true
	test ! -f $(config_dir)/maclist.deny  && > $(config_dir)/maclist.deny  || /bin/true
	if test ! -f $(config_dir)/arpalert.conf; \
	then \
	  > $(config_dir)/arpalert.conf; \
	  echo "# white list" >> $(config_dir)/arpalert.conf; \
	  echo "Maclist file = $(config_dir)/maclist.allow" >> $(config_dir)/arpalert.conf; \
	  echo >> $(config_dir)/arpalert.conf; \
	  \
	  echo "# black list" >> $(config_dir)/arpalert.conf; \
	  echo "Maclist alert file = $(config_dir)/maclist.deny" >> $(config_dir)/arpalert.conf; \
	  echo >> $(config_dir)/arpalert.conf; \
	  \
	  echo "# dump file" >> $(config_dir)/arpalert.conf; \
	  echo "Maclist leases file = $(leases_dir)/arpalert.leases" >> $(config_dir)/arpalert.conf; \
	  echo >> $(config_dir)/arpalert.conf; \
	  \
	  echo "# list of authorized request" >> $(config_dir)/arpalert.conf; \
	  echo "#Auth request file = $(config_dir)/authrq.conf" >> $(config_dir)/arpalert.conf; \
	  echo >> $(config_dir)/arpalert.conf; \
	  \
	  echo "# log file" >> $(config_dir)/arpalert.conf; \
	  echo "#log file = $(log_dir)/arpalert.log" >> $(config_dir)/arpalert.conf; \
	  echo >> $(config_dir)/arpalert.conf; \
	  \
	  echo "# pid file" >> $(config_dir)/arpalert.conf; \
	  echo "Lock file = $(lock_dir)/arpalert.lock" >> $(config_dir)/arpalert.conf; \
	  echo >> $(config_dir)/arpalert.conf; \
	  \
	  cat etc/arpalert.conf.in  >> $(config_dir)/arpalert.conf; \
	else \
	  /bin/true; \
	fi

